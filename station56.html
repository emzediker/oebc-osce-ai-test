<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OEBC Mock OSCE – Station 56 (Progressive Lens Adaptation)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      margin: 0;
      padding: 16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f7f7f9;
      color: #222;
    }
    .oebc-station-step {
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      border-radius: 10px;
      border: 1px solid #e0e0e0;
      padding: 20px;
    }
    textarea {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.95rem;
    }
    button {
      padding: 9px 16px;
      border-radius: 999px;
      border: none;
      font-weight: 600;
      cursor: pointer;
    }
    button:disabled {
      opacity: 0.5;
    }
    .ai-panel {
      margin-top: 1.25rem;
      padding: 16px;
      border-radius: 8px;
      border: 1px solid #cfd8e3;
      background: #f5f7fb;
    }
    .model-answer {
      display: none;
      margin-top: 1rem;
      padding: 16px;
      background: #fff7e6;
      border-left: 4px solid #ff9900;
      border-radius: 6px;
    }
  </style>
</head>

<body>

<div class="oebc-station-step">

  <h2>OEBC Mock OSCE – Station 56</h2>
  <p style="color:#555;">Other • Progressive Lens Adaptation (Interactive)</p>

  <!-- Step 1 -->
  <div style="border:1px solid #e0e0e0; padding:16px; border-radius:8px; margin-bottom:1rem;">
    <h3>Step 1 – Read the Station</h3>

    <p><strong>Scenario:</strong><br>
      A 48-year-old patient is picking up their new progressive lenses for the first time. They are nervous after hearing stories from friends who “couldn’t get used to them.”</p>

    <p><strong>Your task:</strong><br>
      Explain what progressive lenses are, how they work, what adaptation expectations are normal, helpful behaviors, and what symptoms require follow-up.</p>
  </div>

  <!-- Step 2 -->
  <div style="border:1px solid #e0e0e0; padding:16px; border-radius:8px; margin-bottom:1rem;">
    <h3>Step 2 – Speak (Type) Your Response</h3>

    <textarea id="s56-response" rows="8"></textarea>

    <div style="margin-top:1rem; display:flex; gap:8px; flex-wrap:wrap;">
      <button onclick="document.getElementById('s56-key').style.display='block'; this.disabled=true;">
        Show Key Points & Rubric
      </button>

      <button id="s56-ai-btn"
              style="background:#fff5f5; color:#7f1d1d; border:1px solid #b91c1c;">
        Get AI Feedback & Score
      </button>
    </div>
  </div>

  <!-- Step 3 & 4 -->
  <div id="s56-key" style="display:none;">
    <div style="background:#f5f7fb; border:1px solid #cfd8e3; padding:16px; border-radius:8px;">
      <h3>Key Communication Points (What OEBC Expects)</h3>
      <ul>
        <li>Explain what progressives are (distance → intermediate → near corridor).</li>
        <li>Describe normal adaptation symptoms (“swim,” distortion, narrow near zone).</li>
        <li>Give strategies: point nose where you want to look, move head not eyes, consistent wear.</li>
        <li>Discuss computer ergonomics and intermediate zone expectations.</li>
        <li>Set realistic expectations: most adapt within 1–2 weeks.</li>
        <li>Red flags: persistent nausea, diplopia, failure to adapt after 2 weeks.</li>
        <li>Offer follow-up for troubleshooting or adjustment.</li>
      </ul>
    </div>

    <div style="background:#fff; border:1px solid #e0e0e0; padding:16px; border-radius:8px; margin-top:1rem;">
      <h3>Self-Assessment Rubric</h3>
      <table style="width:100%; border-collapse:collapse;">
        <tr><th>Domain</th><th>Criteria</th></tr>
        <tr><td><strong>Explanation</strong></td><td>Described visual zones clearly.</td></tr>
        <tr><td><strong>Expectations</strong></td><td>Included normal distortions + adaptation.</td></tr>
        <tr><td><strong>Strategies</strong></td><td>Provided actionable tips.</td></tr>
        <tr><td><strong>Follow-Up</strong></td><td>Provided timeframe / troubleshooting.</td></tr>
        <tr><td><strong>Communication</strong></td><td>Clear, supportive, empathetic.</td></tr>
      </table>
    </div>
  </div>

  <!-- AI Panel -->
  <div id="s56-ai-panel" class="ai-panel">
    <div id="s56-ai-status" style="display:none;" class="ai-loading">Asking AI…</div>
    <div id="s56-ai-score" class="ai-score"></div>
    <div id="s56-ai-feedback"></div>
    <div id="s56-ai-error" class="ai-error"></div>

    <!-- MODEL ANSWER (HIDDEN UNTIL AFTER AI FEEDBACK) -->
    <div id="s56-model" class="model-answer">
      <h3>Example 10/10 Response</h3>
      <p>
        “Progressive lenses give you distance vision at the top, computer range in the middle,
        and reading at the bottom — all in one lens. Because the lens changes power gradually,
        the sides can feel a little distorted at first, and things may ‘swim’ when you move
        your head. That’s completely normal and usually improves within 1–2 weeks.
        <br><br>
        A few tips make adaptation much easier: point your nose where you want to look,
        move your head instead of just your eyes, and wear the glasses consistently
        rather than switching back and forth. For computer use, you’ll mainly use the
        middle zone, so adjusting your posture and monitor height helps a lot.
        <br><br>
        If you ever feel persistent nausea, double vision, or if reading is still
        difficult after 2 weeks, please come back. I’d like to see you in about
        1–2 weeks anyway just to make sure everything is fitting and functioning well.”
      </p>
    </div>
  </div>

</div>

<script>
  const STATION_ID = 56;
</script>
<script src="osce_ai_feedback.js"></script>

<script>
  const btn = document.getElementById("s56-ai-btn");
  const statusEl = document.getElementById("s56-ai-status");
  const scoreEl = document.getElementById("s56-ai-score");
  const feedbackEl = document.getElementById("s56-ai-feedback");
  const errorEl = document.getElementById("s56-ai-error");
  const modelEl = document.getElementById("s56-model");

  btn.addEventListener("click", async () => {
    const text = document.getElementById("s56-response").value.trim();
    if (!text) {
      errorEl.textContent = "Please type your response first.";
      return;
    }

    errorEl.textContent = "";
    scoreEl.textContent = "";
    feedbackEl.textContent = "";
    modelEl.style.display = "none";
    statusEl.style.display = "block";
    statusEl.textContent = "Asking AI to review your response…";
    btn.disabled = true;

    try {
      const result = await submitOsceResponse({
        stationId: STATION_ID,
        userResponse: text
      });

      statusEl.style.display = "none";

      if (typeof result.score === "number") {
        scoreEl.textContent = `AI Score: ${result.score}/10`;
      }

      feedbackEl.innerHTML = result.feedback || "";

      // Show model answer AFTER feedback
      modelEl.style.display = "block";

    } catch (err) {
      statusEl.style.display = "none";
      errorEl.textContent = "There was a problem getting AI feedback.";
      console.error(err);
    } finally {
      btn.disabled = false;
    }
  });
</script>

</body>
</html>
